<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />

    <title>Uploader</title>
    <style>
      .aligner {
        text-align: center;
      }
      #drop {
        height: 300px;
        line-height: 300px;
        width: 300px;
        border-radius: 150px;
        margin-left: auto;
        margin-right: auto;
        background-color: #f60;
        color: #fff;
        text-align: center;
      }
      .b-example-divider {
        height: 3rem;
        background-color: rgba(0, 0, 0, 0.1);
        border: solid rgba(0, 0, 0, 0.15);
        border-width: 1px 0;
        box-shadow: inset 0 0.5em 1.5em rgba(0, 0, 0, 0.1),
          inset 0 0.125em 0.5em rgba(0, 0, 0, 0.15);
      }

      @media (min-width: 992px) {
        .rounded-lg-3 {
          border-radius: 0.3rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="aligner">
      <div id="drop"><h2>Drop files here!</h2></div>
      <div id="list">
        <h2>Uploaded Files:</h2>
      </div>
    </div>

    <div class="px-4 py-5 my-5 text-center">
      <h1 class="display-5 fw-bold">Audio file transcription accuracy benchmarking</h1>
      <div class="col-lg-6 mx-auto">
        <p class="lead mb-4">
          Benchmark audio files transcription accuracy by comparing the
          transcription vs truth key (the correct transctiption of the file).
        </p>


        <div class="d-grid gap-2 d-sm-flex justify-content-sm-center mb-3">
          <div class="mb-3">
            <label for="formFileSm" class="form-label">File to benchmark</label>
            <input class="form-control" id="formFileSm" type="file">
          </div>
          <div class="mb-3">
            <label for="formFileSm" class="form-label">Truth key (correct transcription)</label>
            <input class="form-control" id="formFileSm" type="file">
          </div>
        </div>


        <div class="d-grid gap-2 d-sm-flex justify-content-sm-center mb-3">
          <button type="button" class="btn btn-primary btn-lg px-4 gap-3">
            Submit
          </button> 
        </div>
        
      </div>
    </div>

    <!-- uncomment and use to divide subsections -->
    <!-- <div class="b-example-divider"></div> -->


    <script type="text/javascript">
      let drop = document.getElementById("drop");
      let list = document.getElementById("list");
      let basePath = "{{base_path}}"; // filled in by the lambda before serving this page
      let uploadBaseUrl = basePath + "api/file/";

      // Do nothing on drag events
      function cancel(e) {
        e.preventDefault();
        return false;
      }

      // Upload on drop events
      function handleDrop(e) {
        e.preventDefault();
        let dt = e.dataTransfer;
        let files = dt.files;
        for (let i = 0; i < files.length; i++) {
          let file = files[i];
          let reader = new FileReader();
          reader.addEventListener("loadend", function (e) {
            fetch(uploadBaseUrl + file.name, {
              method: "POST",
              body: new Blob([reader.result], { type: file.type }),
            }).then((response) => {
              if (response.ok) {
                let uploadedFileNode = document.createElement("div");
                uploadedFileNode.innerHTML = file.name;
                list.appendChild(uploadedFileNode);
              } else {
                alert(
                  "Error uploading [" +
                    file.name +
                    "]. Max upload size is ~4MB."
                );
              }
            });
          });
          reader.readAsArrayBuffer(file);
        }
        return false;
      }

      // Listen to events
      drop.addEventListener("dragenter", cancel);
      drop.addEventListener("dragover", cancel);
      drop.addEventListener("drop", handleDrop);
    </script>

    <!-- Bootstrap Bundle with Popper -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
  </body>

  <!-- Based on https://www.netlify.com/blog/2016/11/17/serverless-file-uploads/ -->
</html>
